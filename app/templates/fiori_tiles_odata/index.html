<!DOCTYPE HTML>
<!-- 
This is a demo app used for testing the proxy capabilities of grunt-contrib-connect 
and grunt-connect-proxy. The app needs to be refactored based on @qmacro's single
page app architecture before being scaffolded.
The app shoes a tile display based on data from the OData service:
	http://services.odata.org:80/Northwind/Northwind.svc/
-->
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<title>OData BlueCrystal Simple Example</title>

<!-- Using the sap.me sub-library requires SAPUI5 as it is not included (yet) in OpenUI6 -->
<script id="sap-ui-bootstrap" src="https://sapui5.netweaver.ondemand.com/resources/sap-ui-core.js"
	type="text/javascript" data-sap-ui-libs="sap.m, sap.me"
	data-sap-ui-theme="sap_bluecrystal">	
</script>
<script type="text/javascript">
	//var sURI= "http://services.odata.org/Northwind/Northwind.svc/";
	var sURI= "http://localhost:8080/Northwind/Northwind.svc/";
	var oModel = new sap.ui.model.odata.ODataModel(sURI, true);
	var oTileCont = new sap.m.TileContainer("tileCont", {});
	sap.ui.getCore().setModel(oModel);
	//Tile Template
	var oTileTmp = new sap.m.StandardTile({
		number : {
			path : "CategoryID",
			formatter : productCount
		},
		numberUnit : "Products",
		icon : "sap-icon://action",
		title : "{CategoryName}",
		info : "{Description}",
		press : _handleTileTap
	});
	//Bind Categories  use template to build tiles,
	oTileCont.bindAggregation("tiles", {
		path : "/Categories",
		template : oTileTmp,
		parameters : { expand : "Products" }
	});

	var page1 = new sap.m.Page("home", { title : "Products by Category"	});
	page1.setEnableScrolling(false).addContent(oTileCont);
	// PAGE 2 //
	var page2 = new sap.m.Page("page2", {
		customHeader : new sap.m.Bar({
			contentLeft : [ new sap.m.Button({
				icon : "sap-icon://home",
				tap : function() { app.back();}
			}) ],
			contentMiddle : [ new sap.m.Label("title", { text : "{CategoryName}"
			}) ]
		}),
		footer : new sap.m.Bar({
			transluscent : "true",
			contentLeft : [ new sap.m.Button({ icon : "sap-icon://action-settings"})]
		}),
		content : [ new sap.m.ObjectHeader({intro : "{Description}" }),

		new sap.me.TabContainer("tabContainer", {
			badgeInfo : { path : "CategoryID", formatter : productCount	},
			contentInfo : new sap.m.List("list", {
				items : {
					path : "Products",
					template : new sap.m.ObjectListItem({
						type : "Active",
						title : "{ProductName}",
						numberUnit : "EUR",
						attributes : [ new sap.m.ObjectAttribute({
							text : "{QuantityPerUnit}"
						}) ],
						number : {
							path : "UnitPrice",
							type : new sap.ui.model.type.Float({
								maxFractionDigits : 2
							})
						}
					})
				}
			})
		}) ]
	});

	var app = new sap.m.App("App");
	app.addPage(page1).addPage(page2).setInitialPage(page1.getId());
	var shell = new sap.m.Shell("Shell",{showLogout : false});
	shell.setApp(app).placeAt('body');

	function _handleTileTap(oEvent) {
		app.to("page2");
		page2.setBindingContext(this.getBindingContext());
	};

	function productCount(oValue) {
		//return the number of products linked to Category
		if (oValue) {
			var sPath = this.getBindingContext().getPath() + '/Products';
			 return this.getModel().bindList(sPath).getContexts().length;
		}
	};
</script>
</head>
<body class="sapUiBody" id="body" role="application">
</body>
</html>

 